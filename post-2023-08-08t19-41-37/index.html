<!DOCTYPE html>
<html lang="en">
  <head>
    <script defer data-domain="devnotes.tramline.app" src="https://plausible.io/js/script.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="https://devnotes.tramline.app/styles/styles.css">
    <link rel="stylesheet" href="https://devnotes.tramline.app/styles/header.css">
    <link rel="apple-touch-icon" sizes="180x180" href="https://devnotes.tramline.app/favicon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://devnotes.tramline.app/favicon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://devnotes.tramline.app/favicon.png">
    <title>Tramline | Engineering notes</title>
    <style type="text/css">
     body {
       text-rendering: optimizeLegibility;
       -webkit-font-smoothing: antialiased;
       -moz-osx-font-smoothing: grayscale;
     }
    </style>
  </head>

  <body class="bg-tram-green-light bg-no-repeat bg-gradient-to-br min-h-screen border-b-8 border-tram-green">
    
<header>
  <div data-collapse="small" data-animation="default" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="nav-bar w-nav">
    <div class="nav-container w-container">
      <div class="logo-div">
        <a href="https://tramline.app" aria-current="page" class="nav-logo w-inline-block w--current">
          <img src="https://devnotes.tramline.app/images/logo.png" loading="eager" width="50" alt="logo" class="logo">
        </a>
      </div>
      <nav role="navigation" class="nav-content w-nav-menu">
        <div class="nav-menu">
          <a href="/" aria-current="page" class="nav-link tramline w-nav-link w--current style-hNwNo" id="style-hNwNo">
            Tramline
            <p class="text-sm">engineering notes</p>
          </a>
        </div>
      </nav>
    </div>
  </div>
</header>

    <div class="border-b mb-3"></div>
    <main>
      <div class="px-2">
        <div class="mb-24 mt-16 px-4">
          <h1 data-w-id="18a9bc4c-33dd-e424-566d-cf277b93ef10" class="text-center heading-large style-J5dMq my-8" id="style-J5dMq">
            Short notes from engineering
          </h1>
          <div class="container max-w-[625px] mx-auto text-center
                      prose prose-lg
                      prose-a:border-b-[1px] prose-a:border-slate-500 prose-a:font-sans prose-a:no-underline
                      hover:prose-a:border-slate-200">
            <p>
              Micro-posts on programming and patterns as we build <a href="https://tramline.app" target="_blank">Tramline</a> in public.
              Follow this <a href="/atom.xml" target="_blank">feed</a> if you find these bits interesting.
            </p>
          </div>
        </div>
      </div>
      

<article class="container max-w-[900px] mx-auto my-8 px-2">
  <hr class="border-slate-200 mx-auto max-w-7xl">
  <div class="my-8"></div>
  <div class="md:flex">
    <div class="md:basis-[100px] md:flex-grow-0 md:flex-shrink-0 md:mr-4 px-1 ml-3 mb-8">
      <div class="font-medium my-2 leading-normal text-xs">
        <div class="tracking-wide">2023 &#x2F; Aug 08 â€” 19:41</div>
        <div class="mt-2 mb-2 underline">kitallis</div>
        <a href="https://devnotes.tramline.app/post-2023-08-08t19-41-37/">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">
            <g fill="none" class="nc-icon-wrapper">
              <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z" fill="#212121">
              </path>
            </g>
          </svg>
        </a>
      </div>
    </div>
    <div class="container max-w-[900px] mx-auto px-4">
      <div class="md:flex-grow md:ml-4">
        <div class="max-w-none
                    prose prose-md
                    prose-a:border-b-[1px] prose-a:border-slate-500 prose-a:font-sans prose-a:no-underline
                    hover:prose-a:border-b-slate-200
                    prose-pre:prose-code:prose-a:text-sm prose-code:prose-p:text-sm
                    prose-h1:font-bold prose-h1:text-base
                    prose-p:font-serif
                    prose-p:prose-blockquote:font-sans
                    prose-strong:font-sans
                    prose-ol:font-serif
                    prose-ul:font-serif">
		      <p><code>then</code> in <a href="https://apidock.com/ruby/v2_6_3/Object/then">Ruby</a> feels like a little sister to the <code>as-&gt;</code> <a href="https://clojuredocs.org/clojure.core/as-%3E">macro</a> from Clojure.</p>
<p>Most of the API code (and several other parts) in Tramline make heavy use of <code>then</code>.</p>
<p><a href="https://github.com/tramlinehq/tramline/blob/main/app/libs/installations/github/api.rb#L20">example</a>, <a href="https://github.com/tramlinehq/tramline/blob/main/app/libs/installations/gitlab/api.rb#L62">example</a>, <a href="https://github.com/tramlinehq/tramline/blob/main/app/libs/installations/google/firebase/api.rb#L49">example</a>.</p>
<p>There's a couple of interesting things of note here.</p>
<p>One, I think <a href="https://ruby-doc.org/core-2.7.0/Proc.html#class-Proc-label-Numbered+parameters">numbered params</a> have a lot of scope in removing some of the block cruft and overnaming of things across <code>then</code> blocks. Especially if the next in chain is visually obvious.</p>
<pre data-lang="ruby" style="background-color:#383838;color:#e6e1dc;" class="language-ruby "><code class="language-ruby" data-lang="ruby"><span style="color:#f6aa11;">@</span><span style="color:#d0d0ff;">client</span><span>.workflows(repo)
</span><span>       .then { fetch_workflows(_1) }
</span><span>       .then { pick_active(_1) }
</span><span>       .then { transform_keys(_1) }
</span></code></pre>
<p>The above feels more natural and less noisy than naming each intermediate step with similar sounding variable names.</p>
<p>The second one is a controversial (perhaps even wrong) point. It seems to me that since <code>then</code> is just a function, the general debuggability of something going wrong in the pipeline is easier to find out in the chain.</p>
<p>My (now fading) experience with threading macro debuggability in Clojure has been less efficient; I end up adding taps and spies and macroexpands to figure out what part of the chain broke.</p>
<p>I prefer an experience like:</p>
<ol>
<li>write a pipeline</li>
<li>pipeline breaks in expression number 2</li>
<li>error output nudges you in the direction of just tweaking expression number 2</li>
<li>make the fix and the pipeline starts working again</li>
</ol>

        </div>
      </div>
	  </div>
  </div>
</article>


    </main>
  </body>
</html>
